---
post_deploy_errands:
- name: broker-registrar

job_types:
- name: broker-registrar
  resource_label: Register broker
  templates:
  - name: broker-registrar
    release: broker-registrar
    consumes: |
      servicebroker:
        from: subway
    manifest: |
      cf:
        api_url: (( $runtime.system_api_url ))
        username: (( ..cf.uaa.admin_credentials.identity ))
        password: (( ..cf.uaa.admin_credentials.password ))
        skip_ssl_validation: (( ..cf.ha_proxy.skip_cert_verify.value ))
  errand: true
  resource_definitions:
  - name: ram
    type: integer
    configurable: false
    default: 512
  - name: ephemeral_disk
    type: integer
    configurable: false
    default: 1024
  - name: persistent_disk
    type: integer
    configurable: false
    default: 0
  - name: cpu
    type: integer
    configurable: false
    default: 1
  static_ip: 0
  dynamic_ip: 1
  max_in_flight: 1
  single_az_only: false
  instance_definition:
    name: instances
    type: integer
    configurable: false
    default: 1

- name: broker-deregistrar
  resource_label: De-register broker
  templates:
  - name: broker-deregistrar
    release: broker-registrar
    consumes: |
      servicebroker:
        from: subway
    manifest: |
      cf:
        api_url: (( $runtime.system_api_url ))
        username: (( ..cf.uaa.admin_credentials.identity ))
        password: (( ..cf.uaa.admin_credentials.password ))
        skip_ssl_validation: (( ..cf.ha_proxy.skip_cert_verify.value ))
  errand: true
  resource_definitions:
  - name: ram
    type: integer
    configurable: false
    default: 512
  - name: ephemeral_disk
    type: integer
    configurable: false
    default: 1024
  - name: persistent_disk
    type: integer
    configurable: false
    default: 0
  - name: cpu
    type: integer
    configurable: false
    default: 1
  static_ip: 0
  dynamic_ip: 1
  max_in_flight: 1
  single_az_only: false
  instance_definition:
    name: instances
    type: integer
    configurable: false
    default: 1
