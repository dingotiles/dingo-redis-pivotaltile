job_types:
- name: grafana
  resource_label: Grafana Dashboard
  templates:
  - {name: grafana, release: prometheus}
  static_ip: 1
  dynamic_ip: 0
  max_in_flight: 1
  resource_definitions:
    - name: ram
      type: integer
      configurable: true
      default: 2048
      constraints:
        min: 1024
    - name: ephemeral_disk
      type: integer
      configurable: true
      default: 10240
      constraints:
        min: 10240
    - name: persistent_disk
      type: integer
      configurable: true
      default: 10240
      constraints:
        min: 10240
    - name: cpu
      type: integer
      configurable: true
      default: 1
  instance_definition:
    name: instances
    type: integer
    configurable: false
    default: 1
    constraints:
      min: 1
      max: 1
  manifest: |
    # route_registrar
    nats:
      machines: (( ..cf.nats.ips ))
      password: (( ..cf.nats.credentials.password ))
      port: 4222
      user: (( ..cf.nats.credentials.identity ))
    route_registrar:
      routes:
      - name: prometheus
        port: 3000
        registration_interval: 20s
        uris:
        - prometheus.(( $runtime.system_domain ))
    grafana:
      dashboards:
        json:
          enabled: true
      database:
        type: postgres
        host: (( .database.first_ip ))
        user: (( .database.properties.database.user.value ))
        password: (( .database.properties.database.password.value ))
        name: (( .database.properties.database.name.value ))
      security:
        admin_user: (( .properties.grafana_username.value ))
        admin_password: (( .properties.grafana_password.value ))
        secret_key: (( .properties.grafana_secret_key.value ))
      session:
        provider: postgres
        provider_config: user=(( .database.properties.database.user.value )) password=(( .database.properties.database.password.value )) host=(( .database.first_ip )) dbname=(( .database.properties.database.name.value )) port=5432 sslmode=disable
      prometheus:
        dashboard_files:
        - /var/vcap/packages/bosh_dashboards/bosh_deployments.json
        - /var/vcap/packages/bosh_dashboards/bosh_jobs.json
        - /var/vcap/packages/bosh_dashboards/bosh_overview.json
        - /var/vcap/packages/bosh_dashboards/bosh_processes.json
        - /var/vcap/packages/bosh_dashboards/prometheus_bosh_exporter.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_apps_events.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_apps_latency.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_apps_requests.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_apps_system.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_bbs.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_cc.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_cells_capacity.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_component_metrics.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_diego_auctions.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_diego_health.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_doppler_server.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_etcd.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_etcd_operations.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_garden_linux.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_lrps_tasks.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_metron_agent.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_metron_agent_doppler.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_organization_summary.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_route_emitter.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_router.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_space_summary.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_summary.json
        - /var/vcap/packages/cloudfoundry_dashboards/cf_uaa.json
        - /var/vcap/packages/cloudfoundry_dashboards/prometheus_cf_exporter.json
        - /var/vcap/packages/cloudfoundry_dashboards/prometheus_firehose_exporter.json
        - /var/vcap/packages/probe_dashboards/probe_https_summary.json
        - /var/vcap/packages/system_dashboards/bosh_system_disk_performance.json
        - /var/vcap/packages/system_dashboards/bosh_system_disk_space.json
        - /var/vcap/packages/system_dashboards/bosh_system_overview.json
        - /var/vcap/packages/system_dashboards/system_disk_performance.json
        - /var/vcap/packages/system_dashboards/system_disk_space.json
        - /var/vcap/packages/system_dashboards/system_overview.json
